# 计算机网络
## [体系结构](#体系结构)
## [物理层](#物理层)
## [数据链路层](#数据链路层)
## [网络层](#网络层)
## 传输层
## 应用层

## 体系结构
通过计算机网络将*分散自治*的计算机链接起来
??定义区分：
- 计算机网络
- 互联网
- 互连网

**计算机网络**  ： 节点+链路
  ｜
  ｜  路由器链接
  v
**互连网**      ： 多个计算机网络连接起来
  ｜
  ｜  世界上最大规模的互连网
  v
**互联网**      ： Internet――由isp提供服务（电信联通）

tips：家用路由器 = 路由器+交换机+其他功能


### 交换技术
- 电路交换
- 报文交换
- 分组交换

*电路交换* ： 通信前建立链接，并且通信过程中双方会一直独占通信资源       但是1.会有额外的时间开销在建立链接上。 2.没有差错控制
*报文交换* ： 无需提前建立链接，存储转发，有校验；线路利用率高           但是：不定长，大报文会让内存变复杂，开销大，容易出错，代价高
*分组交换* ： 把报文分成多段，每个组有自己的首部信息来提供终点和顺序      但是：相对于点路交换有存储发送的时间延迟，容易有丢失
(**路由器**是一种典型的分组交换机)
*虚电路交换* ： 就是在*分组交换*的前提下，在开始前先模拟电路交换先建立链   但是：仍然有转发时延，且控制信息占比增加，复杂度也不低

### 计算机网络的性能指标
- 速率，带宽，吞吐量
- 时延，时延带宽积，往返时延
- 信道利用率

**速率** ： bps
**带宽** ： 某信道能传输的最高数据率，单位：bps
**吞吐量** ： 单位时间内通过某个网络的实际数据量――――>吞+吐，吞吐都要加在一起
**时延** ： 一端传输到另一端所需要的时间
![alt text](image.png)
**时延带宽积** ： 传播时延 * 带宽 = 已发出的但是未到达的最大比特数
**往返时延** ： 在发送端发送文件之后到收到确认信息的时间
**信道利用率** ： 信道有百分之多少的时间是在利用的（太低低效率，太高拥挤）

### OSI参考模型
*“物联网叔会使用”*
![alt text](image-1.png)
![alt text](image-2.png)

### TCP/IP模型
![alt text](image-3.png)


## 物理层
### 物理层的定义
物理层的主要作用就是实现相邻节点之间0和1的传输
![alt text](image-4.png)
### 信道基本概念
- 信源：发送方
- 信号：数据的载体
- 信道：信号的通道
- 码元：一类信号就是一个码元，一个周期出现K种信号，称为k进制码元
- 速率：比特率和波特率，每秒传输几个码元，每秒传输几个bit
#### 信道极限容量
*奈奎斯特定理*：（无噪声，带宽有限）理想低通信道
![alt text](image-5.png)
*香农定理*：有噪声，带宽有限的信道
![alt text](image-6.png)

#### 常见的编码方法
![alt text](image-7.png)
![alt text](image-8.png)

#### 常用的调制方法
![alt text](image-9.png)

### 传输介质
导向型：双绞线，光纤， 同轴电缆
非导向型： 无线传播系统
命名规则： **速度** + **Base** + **介质信息**
![alt text](image-10.png)

## 数据链路层
### 功能
***封装*** ： 把上层封装成帧，转为二进制信号，可以用电磁波传输
***差错控制*** ： 控制帧内错误
***可靠传输*** ： 控制帧丢失等错误
***流量控制*** ： 发送速率
***介质访问控制*** ： 广播信道需要的功能

### 封装
#### 组帧
- 如何界定帧的范围
1. 字符计数法：开头添加一个计数单元，但是一个错了后面的信息全会错
![alt text](image-11.png)
2. 字节填充法：用两个控制字符来标识开头和结尾，如果数据中有相同的编码，那就加上一个esc字符。这样就不会将数据误认为是控制字符
![alt text](image-12.png)
3. 零比特填充法
开头结尾是有六个连续的0，中间每次有五个连续的0，就在后面加一个零，防止有内容冲突
![alt text](image-13.png)
4. 违规编码法：
![alt text](image-14.png)

### 差错控制
目标：发送并检测一个帧内的位错误
#### 检错编码
##### 奇偶校验码
“1”的个数是偶数个或者奇数个，不满足就在校验位上添加
![alt text](image-15.png)

##### 循环冗余校验码
概括：约定一个除数，检查除数是不是为0
![alt text](image-16.png)
![alt text](image-17.png)
![alt text](image-18.png)

##### 海明校验码
原理：在奇偶校验的基础上，增加多位校验码，来确定正确或者错误以及错误位置
![alt text](image-19.png)
校验号pi放在2的i-1次方位置上
![alt text](image-20.png)
![alt text](image-21.png)

### 流量控制+可靠传输
#### 停止等待协议
发送接收窗口大小： 1
确认机制： 接收方接受到第i帧且检测无差错，返回确认信号
重传机制： 如果超时没有收到第i帧，重传
编号： 仅需要1bit

#### 后退n帧协议
发送接收窗口大小： > 1   =1
确认机制： 接收方接受到第i帧**小组**且检测无差错，返回确认信号
重传机制： 如果超时没有收到第i帧，重传
编号： 仅需要nbit。    Wt + Wr < 2的n次方
![alt text](image-22.png)
当确认方到当前组的末端的时候，往发送方发送一个总的ack
![alt text](image-23.png)
![alt text](image-24.png)
![alt text](image-25.png)

#### 选择重传协议
发送接收窗口大小： > 1   >1
确认机制： 接收方接受到第i帧且检测无差错，返回确认信号
重传机制： 如果超时没有收到第i帧，重传
编号： 仅需要nbit。    Wt + Wr < 2的n次方

接受窗口滑动到没收到的节点为止
![alt text](image-26.png)
![alt text](image-27.png)

#### 三种协议的效率分析


### 介质访问控制
介质访问控制（MAC）： 多个节点共享同一个“*总线型*”广播信号时，可能发生“*信号冲突*”

- [**信道划分**](#信道划分)
- [**随机访问**]()
- [**轮询访问**]()

#### 信道划分
##### 时分复用（TDM）
时间切成几片（“TDM”帧）每片再切成几片给节点使用
![alt text](image-28.png)
##### 统计时分复用（STDM）
![alt text](image-29.png)

##### 频分复用（FDM）
其实就是把信号用频率分成不同的独特信道，每个信源都有自己的独特信道
![alt text](image-30.png)
##### 波分复用（WDM）
和频分复用几乎一样，只是换成了电磁波
![alt text](image-31.png)

##### 码分复用（CDM）
不同的信号源发送的几个信号为几个向量
要求各个向量之间相互正交
方便接收方通过向量相乘来分离不同信息
![alt text](image-32.png)

#### 随机访问
##### ALOHA
![alt text](image-33.png)
![alt text](image-34.png)
![alt text](image-35.png)

##### CSMA协议
载波**监听**多路访问协议
也就是说在发送之前先去监听一下这个信道上有没有发送其他信息，没有拥堵再出发
ALOHA：完全不管别人说不说话
CSMA： 有礼貌，别人说话就不说话
![alt text](image-36.png)
![alt text](image-38.png)
![alt text](image-39.png)

##### CSMA/CD协议（冲突检测）
在监听的基础上，增加一个冲突检测的功能
**先听先发，边听边发，冲突停发，随机重发**
传输的时候，如果a在发送的过程中检测到b在发送，那么会立刻停止发送，且这时候a发送的消息会被b检测到，b也会停止发送――――>也就是说会让在发送的停止，也会让还没发送的停止
![alt text](image-40.png)

R倍的争用期：
![alt text](image-39.png)
![alt text](image-41.png)

##### CSMA/CA协议（冲突避免）（用于WIFI）
*CSMA* ： 先监听，发现空闲才发送
*CSMA/CD* ： 一边发送一边监听，检测到冲突停止发送
*CSMA/CA* ： 发送过程中不检测冲突，想办法在发送前避免冲突
为什么不用CSMA/CD ： 
![alt text](image-42.png)
告诉路由器：我要发信息了，你得发一个信号告诉别人你被我占用了
路由器发一个信号告诉其他用户自己即将被占用
![alt text](image-43.png)
![alt text](image-44.png)

## 网络层
应用层提供报文，传输层切分成报文段，网络层在前面加上一段IP数据报首部
网络层为传输层提供服务
将传输层的数据封装成“**IP数据报**”。网络中的路由器根据IP数据报首部中的原IP地址、目的IP地址进行“分组转发”。
因此，网络层实现了“主机到主机”的传输

### 网络层的功能
- [异构网络互联](#异构网络互联)
- [路由与转发](#路由与转发)
- [拥塞控制](#拥塞控制)

##### 异构网络互联
意思为不同的节点传输的时候物理层和数据链路层可能有所区别（拓扑结构，实现不同），但是网络层能消除这种区别，在同一级的网络层上收到的消息还原出来一样
重要的设备：路由器（Router）也被称为网关（Gateway）

##### 路由（Routing）与转发（Forwarding）
路由：各个路由之间相互配合规划IP数据报的最佳转发路径
通过英文Routing更好理解：就是规划路线的意思
转发： 一台路由器自己的事情，根据自己的“转发表”，将收到的IP数据报从合适的接口转发出去

##### 拥塞控制
拥塞：车太多导致超负荷，网络性能下降
网络上出现过量分组，超负荷，引起网络性能下降


### IP协议 （Internet Protocol）


#### IPV4


##### 数据结构
以太网MAC帧记忆口诀：662N4，收发协数验
重要概念：一个链路层数据帧能承载的最大数据量称为最大传送单元（MTU）
如以太网的MTU=1500B
![alt text](image-46.png)
1. 版本 Version（4bit）
表示 IPv4 还是 IPv6。IPv4 就是 4。
2. 首部长度 IHL（4bit）
不是以字节为单位，而是以 4字节(32bit)为单位。
?	IHL=5 ? 5×4B=20B（最常见、最短首部）
?	最大 IHL=15 ? 15×4B=60B
3. 区分服务 ToS/DS 字段（8bit）
用于 QoS（现在常见解释为 DSCP+ECN）。很多课上会说“平时很少用/不重点考”。
4. 总长度 Total Length（16bit）
单位是 字节，表示 整个 IP 包的长度 = 首部 + 数据
16bit ? 0~65535（图里圈的就是这个范围）
5.	标识 Identification（16bit）
用于分片：同一个原始大包被切成多片时，它们的标识相同，方便重组。
6.	标志 Flags（3bit）
常见两位很重要：
	?	DF（Don’t Fragment）：不允许分片
	?	MF（More Fragments）：后面还有分片
7.	片偏移 Fragment Offset（13bit）
表示这个分片在原始数据中的位置，单位是 8 字节（不是 1 字节！）
8.	生存时间 TTL（8bit）
每过一个路由器减 1，减到 0 就丢弃，用来防止死循环。
9.	协议 Protocol（8bit）
指明“上层交给谁处理”：
	?	1=ICMP，6=TCP，17=UDP（这些很常考）
10.	首部检验和 Header Checksum（16bit）
只校验 IP首部（不校验数据）。路由器转发时 TTL 变了，所以检验和也要跟着重算。
11.	源地址 Source IP（32bit）
发出这个包的 IP。
12.	目的地址 Destination IP（32bit）
这个包要送去的 IP。
13.	可选字段 Options（0~40B）
很少在现代互联网中使用（性能原因）。
14.	填充 Padding
因为首部长度必须是 4B 的整数倍，不够就用 0 填到对齐。

##### IP地址
IPv4协议是1981年发明的，当时只有政府、学校、军队等大机构会使用互联网。完全没有预料到互联网用户会迎来爆炸性增长。因此IPv4协议中，地址位数仅设计了32bit（2的32次方约等于42亿）
**单播地址**：个人QQ号
**多播地址**：QQ群号
![alt text](image-47.png)
如果源 IP 和目的 IP 按子网掩码计算得到的网络前缀相同（同一子网/同一广播域），主机不会把包交给默认网关，而是先用 ARP 解析目的 IP 对应的 MAC，然后把 IP 包封装成以太网帧，目的 MAC 填对方 MAC，通过交换机在局域网内转发送达。
![alt text](image-48.png)
![alt text](image-49.png)

##### 子网划分与子网掩码
子网划分技术：把一个大的IP地址块划分成几个独立的IP地址块
子网掩码的作用：用来区分一个 IP 地址中，哪一部分是「*网络号*」，哪一部分是「*主机号*」。（255.255.255.0逐位相与，可以提取网络号）
![alt text](image-50.png)

##### 无分类编制（CIDR）
CIDR 做了两件事：
1. 不再死板地按 A / B / C 类网络划分
2. 用“前多少位是网络号”来表示子网掩码
![alt text](image-51.png)

##### 路由聚合
对于一个路由转发表，如果几条路由表项的转发接口相同，部分网络前缀也相同，那么可以将这几条路由表项聚合为一条。这种地址的聚合称路由聚合，也称构成超网。
![alt text](image-52.png)

##### 网络地址转换（NAT）
Network Address Translation
端口号的概念：用于不同主机上的进程的通信
![alt text](image-53.png)
NAT技术 ： 用来解决IP地址不够用的情况
在同一个局域网中的多台主机，共享同一个全球唯一的IP地址
![alt text](image-54.png)

##### 地址解析协议ARP
![alt text](image-55.png)

##### 动态主机配置协议（DHCP）



#### IPV6
